<app-project-header></app-project-header>

@if (gameState) {
    <div class="game-container main-container">
        <div class="config">
            <qwirkle-hand [hand]="gameState.hand" (selectTilesEvent)="selectedInHand($event)"></qwirkle-hand>
            <qwirkle-stack [stack]="gameState.stack" (selectTileEvent)="selectedInStack($event)"></qwirkle-stack>
        </div>

        <div #board class="highlighted-container board">
            <!--board tiles-->
            <qwirkle-tile *ngFor="let boardTile of gameState.board"
                          [tile]="boardTile.tile"
                          [ngStyle]="getTilePositionStyle(boardTile.position)"
                          [isInteractive]="false"
                          class="board-tile"
            >
            </qwirkle-tile>

            <!--open positions-->
            <ng-container *ngFor="let posInfo of gameState.openPositions">
                <div *ngIf="!posInfo.isDead"
                     [ngStyle]="getTilePositionStyle(posInfo.position)"
                     class="board-tile open-position">
                </div>
            </ng-container>

            <!--valid move tiles-->
            <ng-container *ngFor="let move of validMoves;let i = index">
                <div *ngIf="!(selectedMove && selectedMove.position == move.position)"
                     [ngStyle]="getValidMoveGroupStyle(move)"
                     (click)="chooseValidMove(i)"
                     class="board-tile valid-move"
                >
                </div>
            </ng-container>


            <!--specific valid move tile highlight-->
            <ng-container *ngIf="selectedMove">
                <!--first tile without event listener because direction is unclear-->
                <qwirkle-tile
                              [ngStyle]="getTilePositionStyle(selectedMove.position)"
                              [tile]="selectedMove.tiles[0]"
                              [isInteractive]="false"
                              class="board-tile highlighted-move">
                </qwirkle-tile>

                <!--rendering other tiles with listener to make move-->
                <qwirkle-tile *ngFor="let highlight of selectedMove.boardTiles"
                              [ngStyle]="getTilePositionStyle(highlight.position)"
                              [tile]="highlight.tile"
                              (click)="makeSelectedMove()"
                              class="board-tile highlighted-move"
                >
                </qwirkle-tile>
            </ng-container>
        </div>
    </div>
} @else {
    <button (click)="createState()">Start</button>
}